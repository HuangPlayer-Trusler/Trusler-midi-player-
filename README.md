# Trusler'midi player v0.0.2 GUI

一个功能完整的MIDI播放器应用程序，支持双端口输出、实时监控和乐理分析功能

## 主要功能

### 核心播放功能
- **文件支持**: 加载和播放 MIDI 文件（.mid 和 .midi 格式）
- **双端口输出**: 支持同时连接两个 MIDI 输出端口，独立控制连接状态
- **播放控制**: 完整的播放/暂停/停止/上一首/下一首功能
- **进度显示**: 实时显示当前播放进度和时间信息
- **文件管理**: 添加/移除/清空 MIDI 文件列表

### 实时监控功能
- **复音信息**: 实时显示当前活跃音符表格（音符名称、八度、频率、力度、时长）
- **性能监控**: 消息计数、吞吐量、平均延迟、活跃音符数、队列状态、活跃端口数
- **音符历史**: 列表显示最近播放的音符记录
- **系统日志**: 分级显示（调试/信息/警告/错误）的系统消息，支持过滤

### 乐理分析功能
- **音符信息**: 显示当前音符的基础信息和音程关系
- **和弦识别**: 自动识别和弦类型并显示构成和属性
- **调式分析**: 显示音符在不同调式中的位置
- **音乐信息**: 实时显示拍号、BPM等音乐参数

### 界面特色
- **浮动窗口**: 可独立显示当前活跃音符信息，保持置顶
- **专业配色**: 采用协调的颜色方案，区分不同状态
- **响应式设计**: 支持窗口缩放，保持界面美观
- **圆角设计**: 所有界面元素采用圆润边角，提升视觉体验

### 系统要求
- Python 3.9 或更高版本
- Windows/macOS/Linux 操作系统
- MIDI 输出设备（硬件或虚拟）

### 部署

# 安装所需的Python包
- pip install PyQt6 mido python-rtmidi

# 启动应用程序
python main.py

# 安装loopMIDI虚拟midi硬件(可选)
前往https://www.tobias-erichsen.de/software/loopmidi.html 下载loopmidi（https://www.tobias-erichsen.de/wp-content/uploads/2020/01/loopMIDISetup_1_0_16_27.zip）
- 运行loopMIDISetup.exe安装loopMIDI
- 打开loopMIDI在左下角点+
- 在该项目程序中选择loopMIDI端口即可

## 使用指南

### 1. 端口连接
1. 在"端口连接"区域的下拉框中选择MIDI输出设备
2. 点击"连接"按钮建立端口连接
3. 连接成功后状态会显示为绿色的"已连接"
4. 可以使用"测试连接"按钮验证端口是否正常工作

## 测试虚拟端口转发（已安装loopMIDI）
1. 下载freepiano（https://freepiano.tiwb.com/cn/）或（https://zenlayer.dl.sourceforge.net/project/freepiano/freepiano_2.2.2.1_win64.zip?viasf=1）
2. 解压缩后双击 freepiano.exe即可使用
3. 在freepiano主界面右上角设置中选择loopMIDI端口的"映射到输入"后即可使用本项目程序播放midi文件看效果（在本项目程序中要设置输出端口为loopMIDI端口）

### 2. 文件管理
1. 点击"添加文件"按钮选择MIDI文件
2. 支持批量添加多个文件
3. 选中文件后点击"移除文件"可以删除选中的文件
4. "清空列表"按钮可以清空所有文件
5. 双击文件列表中的文件可以直接播放

### 3. 播放控制
- **播放/暂停**: 点击播放按钮开始播放，再次点击暂停
- **停止**: 停止当前播放并重置进度
- **上一首/下一首**: 在播放列表中切换文件
- **进度条**: 显示当前播放进度，可以拖动调整播放位置

### 4. 实时监控
- **复音信息**: 查看当前正在播放的所有音符的详细信息
- **性能监控**: 监控系统运行状态和性能指标
- **音符历史**: 查看最近播放的音符记录
- **系统日志**: 查看系统运行日志，支持按级别过滤

### 5. 音符信息
- 实时显示当前音符的乐理信息
- 自动识别和弦并显示构成和属性
- 显示音符在不同调式中的位置
- 提供音乐理论学习参考

### 6. 浮动窗口
- 点击"显示浮动音符窗口"按钮打开
- 窗口会始终保持在主窗口上方
- 可以拖动窗口到任意位置
- 关闭窗口时会自动清空内容

## 技术实现

### 多线程架构
- **文件解析线程**: 负责解析MIDI文件并生成事件
- **MIDI发送线程**: 负责将MIDI事件发送到输出端口
- **音符处理线程**: 负责跟踪和处理音符状态
- **UI主线程**: 负责界面更新和用户交互

### 实时性能优化
- 10ms 性能监控更新频率
- 智能事件队列管理
- 多线程安全设计
- 内存优化，支持大文件播放

### 错误处理
- 完善的异常处理机制
- 详细的错误日志记录
- 播放停止时自动关闭所有活跃音符
- 退出程序时正确清理资源

### 专业性
- 支持双端口独立输出，满足专业音频工作需求
- 实时性能监控，确保播放质量
- 完整的MIDI协议支持

### 教育性
- 实时乐理分析功能，帮助学习音乐理论
- 和弦识别和分析，提升音乐理解能力
- 音程关系显示，加深对音乐结构的认识

## 使用技巧

1. **端口管理**: 连接MIDI设备时确保端口未被其他程序占用
2. **文件组织**: 建议将相关的MIDI文件放在同一个文件夹中便于管理
3. **性能监控**: 关注吞吐量和延迟指标，确保系统运行正常
4. **乐理学习**: 利用乐理知识区了解正在播放的音乐结构
5. **浮动窗口**: 在需要专注查看音符信息时使用浮动窗口

## 🔧 常见问题

### Q: 无法连接MIDI设备怎么办？
A: 请检查：
- MIDI设备是否正确连接并已开启
- 设备驱动程序是否已安装
- 端口是否被其他程序占用
- 使用"测试连接"按钮验证

### Q: 播放时没有声音怎么办？
A: 请检查：
- MIDI设备是否已正确连接
- 音量是否已调节到合适水平
- 是否选择了正确的输出端口
- MIDI文件是否包含音符数据

### Q: 程序运行缓慢怎么办？
A: 请尝试：
- 关闭其他不必要的程序
- 减少同时播放的音符数量
- 检查系统资源使用情况
- 确保使用最新版本的依赖包

### 如果您在使用过程中遇到问题，请检查：
1. 系统要求是否满足
2. 依赖包是否已正确安装
3. MIDI设备是否正常工作
4. 查看系统日志获取详细错误信息

---

**开发信息**: This program code by Trusler (部分AI)
**版本**: v0.0.2
**更新日期**: 2025-09-14

## 本项目仅供学习和研究使用
